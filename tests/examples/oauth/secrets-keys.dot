digraph "top" {
  // Base Styling
  compound=true
  graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9"];

  // Start and end nodes
  reality[ label="Reality"  fontname="Arial"  fontsize="20"  fontcolor="white"  fillcolor="black"  color="black"  shape="box"  style="filled, rounded" ]
  attacker_wins[ label="ATTACKER WINS!"  fontname="Arial"  fontsize="20"  fontcolor="red"  fillcolor="yellow"  color="red"  shape="box"  style="filled, rounded" ]
  subgraph cluster_Client_secrets_and_keys {
    label=<<B>Client secrets<br></br>and keys</B>>
    graph[style="filled, rounded" rankdir="LR" splines="true" overlap="false" nodesep="0.2" ranksep="0.9" fontname="Arial"  fontsize="24"  fontcolor="black"  fillcolor="transparent"  color="gray" ];
    webapplication_uses_input_to_calculate_config_file_path[label="web-application\nuses input to\ncalculate config file path"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
    Secrets_extracted_via_encoded_path_in_URL_sent_to_Apache_Web_Server[label="Secrets\nextracted via encoded path\nin URL sent to Apache\nWeb Server"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="red"  color="red"]
    webserver_is_vulnerable_to_path_traversal_via_encoded_URLs[label="web-server is\nvulnerable to path traversal\nvia encoded URLs"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
    application_uses_config_files_for_secrets[label="application uses\nconfig files for secrets"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
    Dont_store_secrets_in_config_file[label="Don't store\nsecrets in config file"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="blue"  color="blue"]
    app_binary_access[label="app binary access"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
    application_uses_webconfig_files_for_secrets[label="application uses\nweb-config files for secrets"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
    webapplication_config_file_exposed_via_URL[label="web-application\nconfig file exposed via\nURL"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
    secrets_are_stored_in_configuration_file[label="secrets are\nstored in configuration\nfile"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
    code_repo_access[label="code repo access"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
    Dont_publish_app_binary_containing_secrets[label="Don't publish app\nbinary containing\nsecrets"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="purple"  color="blue"]
    use_Apache_Web_Server_v2551_or_later[label="use Apache Web\nServer v2.5.51 or later"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="purple"  color="blue"]
    Secrets_extracted_from_code[label="Secrets\nextracted from code"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="red"  color="red"]
    secrets_and_keys_are_stored_in_configuration_file[label="secrets and keys\nare stored in\nconfiguration file"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
    webserver_is_Apache_version_lteq_v2550[label="web-server is\nApache (version <=\nv2.5.50)"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
    Block_encoded_paths[label="Block encoded\npaths"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="purple"  color="blue"]
    Webserver_shouldnt_serve_config_files[label="Web-server\nshouldn't serve config\nfiles"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="purple"  color="blue"]
    Store_secrets_and_keys_in_vault[label="Store secrets and\nkeys in vault"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="blue"]
    Encrypt_secrets_before_storing_in_file[label="Encrypt secrets\nbefore storing in file"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="blue"]
    Dont_publish_code_containing_secrets[label="Don't publish\ncode containing\nsecrets"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="blue"  color="blue"]
    Secrets_extracted_from_app_binary[label="Secrets\nextracted from app binary"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="red"  color="red"]
    Secrets_extracted_via_encoded_path_in_URL[label="Secrets\nextracted via encoded path\nin URL"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="red"  color="red"]
    Compromize_web_server[label="Compromize web\nserver"  shape="box3d"  style="filled, dashed"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="black"  fillcolor="transparent"  color="red"]
    Secrets_extracted_via_path_traversal[label="Secrets\nextracted via path\ntraversal"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="red"  color="red"]
    Secrets_extracted_via_webserver_path_traversal[label="Secrets\nextracted via web-server\npath traversal"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="red"  color="red"]
    Dont_allow_path_traversal_to_configuration_files[label="Don't allow path\ntraversal to configuration\nfiles"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="16"  fontcolor="white"  fillcolor="purple"  color="blue"]
    {rank="same"; app_binary_access; application_uses_webconfig_files_for_secrets; webapplication_uses_input_to_calculate_config_file_path; webapplication_config_file_exposed_via_URL; secrets_and_keys_are_stored_in_configuration_file; webserver_is_vulnerable_to_path_traversal_via_encoded_URLs; secrets_are_stored_in_configuration_file; webserver_is_Apache_version_lteq_v2550; secrets_are_stored_in_configuration_file; code_repo_access; secrets_are_stored_in_configuration_file; application_uses_config_files_for_secrets; webserver_is_Apache_version_lteq_v2550; secrets_are_stored_in_configuration_file; }
  }
  Secrets_extracted_from_app_binary -> Dont_publish_app_binary_containing_secrets
  Secrets_extracted_from_app_binary -> Dont_publish_code_containing_secrets
  Secrets_extracted_from_app_binary -> Dont_store_secrets_in_config_file
  application_uses_webconfig_files_for_secrets -> Secrets_extracted_via_path_traversal
  reality -> app_binary_access
  reality -> webapplication_uses_input_to_calculate_config_file_path
  reality -> application_uses_webconfig_files_for_secrets
  reality -> webapplication_config_file_exposed_via_URL
  reality -> secrets_and_keys_are_stored_in_configuration_file
  reality -> webserver_is_vulnerable_to_path_traversal_via_encoded_URLs
  reality -> secrets_are_stored_in_configuration_file
  reality -> webserver_is_Apache_version_lteq_v2550
  reality -> Compromize_web_server
  reality -> code_repo_access
  reality -> Encrypt_secrets_before_storing_in_file
  reality -> Store_secrets_and_keys_in_vault
  reality -> application_uses_config_files_for_secrets
  code_repo_access -> Secrets_extracted_from_code
  app_binary_access -> Secrets_extracted_from_app_binary
  webapplication_uses_input_to_calculate_config_file_path -> Secrets_extracted_via_path_traversal
  secrets_are_stored_in_configuration_file -> Secrets_extracted_via_encoded_path_in_URL
  secrets_are_stored_in_configuration_file -> Secrets_extracted_via_encoded_path_in_URL_sent_to_Apache_Web_Server
  secrets_are_stored_in_configuration_file -> Dont_allow_path_traversal_to_configuration_files
  secrets_are_stored_in_configuration_file -> Webserver_shouldnt_serve_config_files
  application_uses_config_files_for_secrets -> Dont_store_secrets_in_config_file
  webserver_is_Apache_version_lteq_v2550 -> Secrets_extracted_via_encoded_path_in_URL_sent_to_Apache_Web_Server
  webserver_is_Apache_version_lteq_v2550 -> use_Apache_Web_Server_v2551_or_later
  webserver_is_vulnerable_to_path_traversal_via_encoded_URLs -> Secrets_extracted_via_encoded_path_in_URL
  Secrets_extracted_from_code -> Dont_publish_code_containing_secrets
  Secrets_extracted_from_code -> Dont_store_secrets_in_config_file
  webapplication_config_file_exposed_via_URL -> Secrets_extracted_via_webserver_path_traversal
  secrets_and_keys_are_stored_in_configuration_file -> Secrets_extracted_via_webserver_path_traversal
  Secrets_extracted_via_encoded_path_in_URL -> Block_encoded_paths
  Secrets_extracted_via_encoded_path_in_URL_sent_to_Apache_Web_Server -> use_Apache_Web_Server_v2551_or_later
  Secrets_extracted_via_webserver_path_traversal -> Dont_allow_path_traversal_to_configuration_files
  Secrets_extracted_via_webserver_path_traversal -> Webserver_shouldnt_serve_config_files
  Secrets_extracted_via_path_traversal -> attacker_wins[ penwidth="4"  color="red" ]
  Secrets_extracted_from_code -> attacker_wins[ penwidth="4"  color="red" ]
  subgraph cluster_Legend {
    label="Legend"
    graph[style="filled, rounded" rankdir="LR" fontsize="16" splines="true" overlap="false" nodesep="0.1" ranksep="0.2" fontname="Courier" fillcolor="lightyellow" color="yellow"];
    A[label="Pre-\nCondition"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="12"  fontcolor="black"  fillcolor="lightgray"  color="gray"]
    B[label="Assumptions"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="12"  fontcolor="white"  fillcolor="dimgray"  color="dimgray"]
    C[label="Attack"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="12"  fontcolor="white"  fillcolor="red"  color="red"]
    D[label="Pre-emptive\nDefense"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="12"  fontcolor="white"  fillcolor="purple"  color="blue"]
    E[label="Incident\nResponse"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="12"  fontcolor="white"  fillcolor="blue"  color="blue"]
    F[label="Policy"  shape="box"  style="filled, rounded"  margin="0.2"  fontname="Arial"  fontsize="12"  fontcolor="black"  fillcolor="darkolivegreen3"  color="darkolivegreen3"]
  }
  A -> reality [style="invis" ltail="cluster_Legend"]
  B -> reality [style="invis" ltail="cluster_Legend"]
  C -> reality [style="invis" ltail="cluster_Legend"]
  D -> reality [style="invis" ltail="cluster_Legend"]
  E -> reality [style="invis" ltail="cluster_Legend"]
  F -> reality [style="invis" ltail="cluster_Legend"]
}